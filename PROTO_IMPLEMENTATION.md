# Proto Transformation - Implementation Guide

## Overview

This document describes the complete transformation of the multi-agent business automation platform into **Proto** - a single adaptive AI agent that grows with your business.

### Tagline
**"Grow with your business to grow your business"**

## Core Concept

### Before
- 6 separate agents (Operations, Customer Support, HR, Inventory, Financial, Documents)
- Each agent had isolated capabilities and context
- No cross-agent memory or learning

### After
- **ONE adaptive agent named "Proto"**
- Morphs capabilities based on user needs
- Unified memory system that remembers everything
- Learns and improves over time

## Architecture Changes

### Database Schema

#### New Tables

**proto_memory**
- Stores all of Proto's memories about the business
- Categories: business_context, preference, relationship, process, goal
- Subcategories: team, customer, financial, operational
- Importance scoring (1-10) for prioritization
- Access tracking for relevance scoring

**proto_conversations**
- Stores conversation threads with Proto
- Auto-generated titles
- Tag support for organization
- Message count tracking

**workspaces**
- Collaborative workspace data (whiteboard, task_board, document_review)
- Stores canvas state, sticky notes, etc.
- Multi-user collaboration support

#### Schema Updates
- Added `onboarding_completed` to `user_profiles`
- Added `proto_context` JSONB field to `user_profiles`

### API Routes

**POST /api/proto/onboarding**
- Stores onboarding questionnaire data as Proto memories
- Creates high-importance memories for business context

**POST /api/proto/chat**
- Unified chat endpoint with memory context
- Retrieves relevant memories before responding
- Includes document context in responses
- Uses Cohere Command-R-Plus model

**GET /api/proto/memories**
- Retrieves Proto's memories with optional filtering
- Supports type and category filters
- Returns memories sorted by importance

## Components

### 1. ProtoIntroduction.tsx
Character-by-character animated onboarding experience.

**Features:**
- Typing animation (20ms per character)
- Pulsing avatar with boxShadow animation
- 5-question onboarding form:
  - What type of business do you run?
  - What are your biggest daily challenges?
  - What goals are you working toward?
  - How many people are on your team?
  - What takes up most of your time each day?
- Skip option for returning users
- Framer Motion animations

**Usage:**
```tsx
<ProtoIntroduction 
  onComplete={handleOnboardingComplete}
  onSkip={() => setShowOnboarding(false)}
/>
```

### 2. ThinkingIndicator.tsx
Claude/Notion-style thinking animation.

**Features:**
- Rotating brain icon
- Current step display with animation
- Progress bar (0-100%)
- Estimated time remaining
- Pulsing dots animation

**Usage:**
```tsx
<ThinkingIndicator 
  state={{
    isThinking: true,
    currentStep: "Analyzing documents...",
    progress: 45,
    estimatedTime: "~1 minute remaining"
  }}
/>
```

### 3. WhiteboardCanvas.tsx
Infinite canvas workspace for brainstorming.

**Features:**
- Drag-and-drop sticky notes
- Zoom controls (50% - 200%)
- Grid background
- Save/load workspace state
- Clear all notes confirmation

**Usage:**
```tsx
<WhiteboardCanvas
  workspaceId="workspace-123"
  initialNotes={savedNotes}
  onSave={(notes) => saveToDatabase(notes)}
/>
```

### 4. StickyNote.tsx
Draggable sticky notes with color options.

**Features:**
- 4 color options (yellow, pink, blue, green)
- Drag-and-drop positioning
- Inline editing
- Random slight rotation for natural look
- Delete functionality

**Properties:**
```typescript
interface StickyNote {
  id: string;
  content: string;
  color: 'yellow' | 'pink' | 'blue' | 'green';
  position: { x: number; y: number };
  author: string;
  createdAt: Date;
  tags?: string[];
  linkedTo?: string[];
}
```

### 5. MemoryViewer.tsx
Display and manage Proto's memories.

**Features:**
- Filter by memory type (all, business_context, preference, etc.)
- Show/hide memory values
- Delete memories
- Importance indicators with color coding
- Access count tracking
- Last accessed timestamps

**Usage:**
```tsx
<MemoryViewer userId={user.id} />
```

### 6. OutputPreview.tsx
Preview generated outputs with actions.

**Features:**
- Copy to clipboard
- Email integration
- Download functionality
- Support for text, markdown, code, table formats
- "Generated by Proto" footer

**Usage:**
```tsx
<OutputPreview
  title="Draft Email Response"
  content={emailContent}
  type="text"
  onDownload={() => downloadFile()}
  onEmail={() => openEmailClient()}
/>
```

### 7. TeamActivity.tsx
Real-time activity feed.

**Features:**
- Proto actions, user actions, team actions
- Status indicators (in_progress, completed, pending)
- Time ago display
- Icon differentiation by action type

**Usage:**
```tsx
<TeamActivity activities={recentActivities} />
```

### 8. CapabilityCard.tsx
Contextual capability suggestions.

**Features:**
- Icon-based capability display
- Example use cases
- Notion-inspired color schemes
- Hover animations (scale, translate)
- Click handler for quick actions

**Usage:**
```tsx
<CapabilityCard
  icon={Mail}
  title="Draft Customer Response"
  description="Generate professional email responses"
  examples={[
    "Draft refund approval email",
    "Write apology for delayed shipment"
  ]}
  color="indigo"
  onClick={() => startTask('draft_email')}
/>
```

## Design System

### Colors (Notion-Inspired)

**Background:**
- DEFAULT: #FFFFFF
- secondary: #F7F6F3
- tertiary: #EFEEEB
- hover: #E9E8E6

**Text:**
- primary: #37352F
- secondary: #787774
- tertiary: #9B9A97

**Agent Colors:**
- indigo (Proto): #6478BB
- sky: #6699C8
- lavender: #8B7FAC
- sage: #5F8A48
- honey: #C19F5F
- clay: #9D8565

### Animations

**Timing:**
- Fast transitions: 150ms
- Standard transitions: 200-300ms
- Slow transitions: 400ms

**Easing:**
- `cubic-bezier(0.23, 1, 0.32, 1)` for smooth, natural motion

**Common Patterns:**
```tsx
// Button hover
whileHover={{ scale: 1.02 }}
whileTap={{ scale: 0.98 }}

// Card entrance
initial={{ opacity: 0, y: 10 }}
animate={{ opacity: 1, y: 0 }}

// Fade in
initial={{ opacity: 0 }}
animate={{ opacity: 1 }}
transition={{ duration: 0.2 }}
```

### Shadows

```css
shadow-notion: Subtle 3-layer shadow for cards
shadow-notion-sm: Smaller shadow for interactive elements
shadow-notion-hover: Enhanced shadow on hover
```

## Proto System Prompt

The unified system prompt includes:

1. **Core Principles:**
   - Remember everything
   - Be proactive
   - Think step-by-step
   - Produce tangible outputs
   - Adapt expertise

2. **Memory Usage:**
   - Check relevant context before responding
   - Store important details
   - Reference past work

3. **Output Types:**
   - Schedules (Excel/CSV/PDF)
   - Draft emails and messages
   - Financial summaries
   - Analysis documents
   - Action plans

4. **Working Style:**
   - Show thinking process
   - Provide progress updates
   - Ask clarifying questions
   - Cite sources
   - Acknowledge limitations

## Proto Capabilities

### ✓ Draft Professional Emails and Customer Responses
- Handle customer questions, complaints, disputes
- Generate professional, reusable responses
- Draft follow-ups and FAQs

### ✓ Create Staff Schedules and Manage Availability
- Generate optimized schedules
- Detect conflicts
- Suggest shift swaps

### ✓ Analyze Contracts, Invoices, and Documents
- Review contracts for key terms
- Identify red flags
- Compare documents
- Explain in plain English

### ✓ Help When You're Short-Staffed
- Suggest coverage solutions
- Recommend task delegation
- Provide actionable workarounds

### ✓ Coordinate Between You and Your Team
- Facilitate decisions
- Track tasks
- Enable collaborative workspaces

### ✓ Work Autonomously on Complex Tasks
- Show thinking process
- Execute multi-step tasks
- Real-time status updates

## Memory System

### Memory Types

**business_context**
- Business type, industry, size
- Team structure and roles
- Current challenges
- Time-consuming tasks

**preference**
- Communication style
- Working hours
- Tool preferences
- Decision-making patterns

**relationship**
- Customer relationships
- Vendor relationships
- Team dynamics
- Stakeholder preferences

**process**
- Standard operating procedures
- Workflows and automations
- Approval processes
- Quality checks

**goal**
- Short-term objectives
- Long-term vision
- KPIs and metrics
- Growth targets

### Memory Importance Scoring

- **10:** Critical business context (business type, core goals)
- **8-9:** High-importance operational details
- **5-7:** Useful context and preferences
- **3-4:** Nice-to-have details
- **1-2:** Low-priority information

### Memory Retrieval

Memories are retrieved based on:
1. Importance score (higher = more likely)
2. Access frequency (more accessed = more relevant)
3. Recency (recently accessed = more relevant)
4. Context match (category/type alignment)

## Migration Guide

### For Existing Users

1. Run database migration: `20260102_proto_unified_agent.sql`
2. Existing agent_memory data remains intact
3. Users will see onboarding on first Proto visit
4. Old agent pages remain accessible during transition

### For New Users

1. Land on dashboard with Proto introduction
2. Complete 5-question onboarding
3. Memories stored automatically
4. Ready to use Proto immediately

## Testing Checklist

- [ ] Onboarding flow completes successfully
- [ ] Memories stored in database
- [ ] Proto chat retrieves relevant memories
- [ ] ThinkingIndicator displays during processing
- [ ] Whiteboard canvas saves/loads state
- [ ] Sticky notes drag and persist
- [ ] MemoryViewer filters correctly
- [ ] OutputPreview copy/download works
- [ ] Animations are smooth (no jank)
- [ ] Mobile responsive design works
- [ ] All API routes return expected data

## Deployment

### Environment Variables Required

```env
# Cohere
COHERE_API_KEY=your_key_here

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_key

# Other existing variables...
```

### Database Setup

1. Run migration in Supabase SQL editor
2. Verify tables created: `proto_memory`, `proto_conversations`, `workspaces`
3. Check indexes created successfully
4. Verify triggers active

### Rollback Plan

If issues arise:
1. Keep old agent pages active
2. Hide Proto onboarding
3. Revert to multi-agent dashboard
4. Proto tables remain for future retry

## Performance Considerations

### Memory Queries
- Indexed by user_id, memory_type, category
- Limit to top 10 most important for chat context
- Cache frequently accessed memories (future enhancement)

### Component Rendering
- Use React.memo for expensive components
- Lazy load whiteboard canvas
- Virtual scrolling for large activity feeds (future)

### Animation Performance
- Use transform and opacity for animations
- Avoid layout thrashing
- Hardware acceleration via transform3d

## Future Enhancements

1. **Predictive Suggestions:** Based on memory patterns
2. **Cross-Reference Past Work:** "Based on the schedule we created last week..."
3. **Proactive Insights:** Proto suggests actions before being asked
4. **Voice Interface:** Talk to Proto
5. **Mobile App:** Native Proto experience
6. **Advanced Workspaces:** Real-time collaboration
7. **Integration Suggestions:** Proto recommends tools to connect

## Support

For issues or questions:
1. Check migration completed successfully
2. Verify environment variables set
3. Check browser console for errors
4. Review Supabase logs for API errors
5. Test with minimal data first

---

**Built with:**
- Next.js 16 + React 19
- TypeScript
- Framer Motion
- Tailwind CSS
- Supabase
- Cohere AI
- Lucide Icons
